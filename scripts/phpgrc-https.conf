# HTTPS-only vhost for phpGRC (no port 80)
# DocumentRoot points at the "current" symlink managed by the deploy workflow.

<VirtualHost *:443>
    ServerName phpgrc.gruntlabs.net

    # --- SSL ---
    SSLEngine on
    # Replace these three paths with your real certs/chain.
    SSLCertificateFile      /etc/ssl/certs/gruntlabs.pem
    SSLCertificateKeyFile   /etc/ssl/private/gruntlabs.key

    # --- App path ---
    DocumentRoot /var/www/phpgrc/current/web
    <Directory /var/www/phpgrc/current/web>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>

    # Security headers (baseline)
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "0"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    # Minimal CSP for placeholder; will be revisited with SPA
    Header always set Content-Security-Policy "default-src 'self'; frame-ancestors 'self'; base-uri 'self'"

    # HSTS (preload-ready) — safe now since we’re HTTPS-only by requirement
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

    # Logs
    ErrorLog  /var/log/apache2/phpgrc_error.log
    CustomLog /var/log/apache2/phpgrc_access.log combined

    # Don’t leak directory listings anywhere else
    <Directory />
        Options -Indexes
    </Directory>
</VirtualHost>

# Ensure only 443 is used for this vhost
# No :80 vhost provided by design (HTTPS-only)
