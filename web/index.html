<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/api/favicon.ico" />
    <title>phpGRC</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
    </style>
    <script>
      (function () {
        var DEFAULT_THEME = "slate";
        var DEFAULT_MODE = "dark";
        var DEFAULT_SOURCE = "bootswatch";
        var THEME_STORAGE_KEY = "phpgrc.theme.selection";
        var THEME_COOKIE_NAME = "phpgrc_theme_selection";
        var LOGIN_LAYOUT_STORAGE_KEY = "phpgrc.login.layout";
        var LOGIN_LAYOUT_COOKIE = "phpgrc_login_layout";
        var DEFAULT_LOGIN_LAYOUT = "layout_1";

        function getStoredSelection() {
          var raw = null;
          if (typeof window !== "undefined") {
            try {
              var store = window.localStorage;
              if (store) {
                raw = store.getItem(THEME_STORAGE_KEY);
              }
            } catch (err) {
              raw = null;
            }
          }

          if (!raw && typeof document !== "undefined") {
            var cookies = document.cookie ? document.cookie.split(";") : [];
            for (var i = 0; i < cookies.length; i += 1) {
              var entry = cookies[i].trim();
              if (entry && entry.indexOf(THEME_COOKIE_NAME + "=") === 0) {
                raw = entry.substring(THEME_COOKIE_NAME.length + 1);
                try {
                  raw = decodeURIComponent(raw);
                } catch (err) {
                  // ignore decode errors; raw remains encoded
                }
                break;
              }
            }
          }

          if (!raw) return null;
          try {
            return JSON.parse(raw);
          } catch (err) {
            return null;
          }
        }

        function prefersDark() {
          if (typeof window === "undefined" || typeof window.matchMedia !== "function") return false;
          try {
            return window.matchMedia("(prefers-color-scheme: dark)").matches;
          } catch (err) {
            return false;
          }
        }

        function sanitizeLoginLayout(value) {
          if (typeof value !== "string") return null;
          var token = value.trim().toLowerCase();
          return token === "layout_1" || token === "layout_2" || token === "layout_3"
            ? token
            : null;
        }

        function getStoredLoginLayout() {
          if (typeof window !== "undefined") {
            try {
              var stored = window.localStorage && window.localStorage.getItem(LOGIN_LAYOUT_STORAGE_KEY);
              var layout = sanitizeLoginLayout(stored);
              if (layout) return layout;
            } catch (err) {
              // ignore storage errors
            }
          }

          if (typeof document === "undefined") return null;
          var cookies = document.cookie ? document.cookie.split(";") : [];
          for (var i = 0; i < cookies.length; i += 1) {
            var entry = cookies[i].trim();
            if (!entry) continue;
            if (entry.indexOf(LOGIN_LAYOUT_COOKIE + "=") === 0) {
              var token = entry.substring(LOGIN_LAYOUT_COOKIE.length + 1);
              try {
                token = decodeURIComponent(token);
              } catch (err) {
                // ignore decode errors; fallback to raw token
              }
              var layout = sanitizeLoginLayout(token);
              if (layout) return layout;
            }
          }

          return null;
        }

        try {
          var stored = getStoredSelection();
          var slug = stored && typeof stored.slug === "string" ? stored.slug : DEFAULT_THEME;
          var modeCandidate = stored && (stored.mode === "light" || stored.mode === "dark") ? stored.mode : null;
          var mode = modeCandidate || (prefersDark() ? "dark" : DEFAULT_MODE);
          var variant =
            stored && typeof stored.variant === "string" && stored.variant !== "" ? stored.variant : mode;
          var source = stored && typeof stored.source === "string" ? stored.source : DEFAULT_SOURCE;

          var html = document.documentElement;
          html.setAttribute("data-theme", slug);
          html.setAttribute("data-mode", mode);
          html.setAttribute("data-bs-theme", mode);
          html.setAttribute("data-theme-variant", variant);
          html.setAttribute("data-theme-source", source);

          var storedLayout = sanitizeLoginLayout(html.getAttribute("data-login-layout")) || getStoredLoginLayout();
          html.setAttribute("data-login-layout", storedLayout || DEFAULT_LOGIN_LAYOUT);
        } catch (err) {
          var fallbackHtml = document.documentElement;
          fallbackHtml.setAttribute("data-theme", DEFAULT_THEME);
          fallbackHtml.setAttribute("data-mode", DEFAULT_MODE);
          fallbackHtml.setAttribute("data-bs-theme", DEFAULT_MODE);
          fallbackHtml.setAttribute("data-theme-variant", DEFAULT_MODE);
          fallbackHtml.setAttribute("data-theme-source", DEFAULT_SOURCE);
          fallbackHtml.setAttribute("data-login-layout", DEFAULT_LOGIN_LAYOUT);
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
